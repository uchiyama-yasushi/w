データブロックの管理

1つのファイルにはデータブロックおよび記憶ブロックが連続して割当てられま
す。ファイルシステで使用される最後のデータブロックの後ろのデータブロッ
クは、ファイルをするために利用可能な次のデータブロックであると考えられ
ます。ファイルが削除されると、そのファイルに割当てられたデータブロック
は開放されます。しかしファイルシステムでそれらのブロックが再利用される
のは以下のいずれかの場合に限られています。

+ ファイルシステムに格納され最後のファイルが削除された場合
+ システムがコンパクションの必要性を認識し、それを実行する場合

コンパクション

コンパクションは、ファイルが削除されたことによってできたギャップがなく
なるまで、既存のファイルをシフトしてデータブロックを回復する方法です。
この操作は非常にコストの高い処理ですが、bfsがファイルを格納したり削除す
る方法を考えると必要であるといえます。

システムは、以下のいずれかの場合にコンパクションの必要性を認識して、そ
れを実行します。

+ システムがファイルシステムの終端に達したが、まだ利用可能なフリーブロッ
クが残っている場合

+ システムが非常に大きなファイルを削除するとき、ディスク上でそのファイ
ルの次にあるファイルが小さく、かつファイルシステムの最後のファイルであ
る場合(小さなファイルとは10ブロック程度のファイル、大きなファイルとは
500ブロック以上のファイルをいいます)

bfsスーパーブロック
サニティワード

コンパクションのときにファイルシステムの整合性を改善するために使用する
4つのワードがあります。これらはコンパクションのプロセスの間にシステムク
ラッシュがあった場合、fsckコマンドによって修復を行うときに使用されます。

